# ë¬¸ìì—´ í…œí”Œë¦¿ ë¦¬í„°ëŸ´ í˜•ì‹
## 6.1 ì‚¬ìš©ì ì •ì˜ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ì •ì˜í•˜ê¸°
---

### 1. ì´ ì¥ì€

- ë¬¸ìì—´ ë¦¬í„°ëŸ´ íƒ€ì…ì„ ì‚¬ìš©í•´ **ì¼ì • íŒ¨í„´ì„ ë”°ë¥´ëŠ” ë¬¸ìì—´ë§Œ í—ˆìš©í•˜ëŠ” íƒ€ì…ì„ ë§Œë“¤ê³ **,
- ì´ íƒ€ì…ì„ í™œìš©í•´ **ì´ë²¤íŠ¸ ì´ë¦„ì´ íŠ¹ì • í˜•ì‹ì„ ë”°ë¥´ë„ë¡ ê°•ì œ**í•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤.

---

### 2. ìš°ë¦¬ê°€ ë‹¤ë£¨ëŠ” ëŒ€ìƒ

- ëª¨ë“  ì´ë²¤íŠ¸ ì´ë¦„ì€ `"on"`ìœ¼ë¡œ ì‹œì‘í•´ì•¼ í•œë‹¤ëŠ” ê·œì¹™ì„ ì ìš©í•œ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ

```ts
type EventName = `on${string}`;
```

- `EventName` íƒ€ì…ì€ `"on"`ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ë¬¸ìì—´ì„ í—ˆìš©
```ts
system.defineEventHandler("click", () => {});     // âŒ ì˜¤ë¥˜
system.defineEventHandler("onClick", () => {});   // âœ… í—ˆìš©
```

---

### 3. ë¬¸ì œ ìƒí™©

#### ê¸°ì¡´ ë°©ì‹ì˜ í•œê³„

- ë¬¸ìì—´ ì „ì²´ë¥¼ stringìœ¼ë¡œ ì„ ì–¸í•˜ë©´ ë„ˆë¬´ **ë²”ìœ„ê°€ ë„“ì–´ íƒ€ì… ì¶”ë¡ ì´ ë¶ˆê°€ëŠ¥**í•¨
- ë°˜ëŒ€ë¡œ `"onClick" | "onChange" | ...`ì²˜ëŸ¼ ì¼ì¼ì´ ì •ì˜í•˜ë©´ **í™•ì¥ì„±ì´ ì—†ìŒ**

---

### 4. í•´ê²° ì „ëµ

#### âœ… í…œí”Œë¦¿ ë¦¬í„°ëŸ´ íƒ€ì… ì‚¬ìš©

```ts
type EventName = `on${string}`;
```

- `"on"`ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë¬¸ìì—´ë§Œ í—ˆìš©ë¨
- í…œí”Œë¦¿ ë¦¬í„°ëŸ´ íƒ€ì…ì€ JavaScriptì˜ ë°±í‹± ë¬¸ìì—´ê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ **íƒ€ì… ìˆ˜ì¤€**ì—ì„œ ì‘ë™
- `${}` ì•ˆì—ëŠ” string, number ë“±ì˜ ë¦¬í„°ëŸ´ íƒ€ì…ë§Œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŒ



#### í™œìš© ì˜ˆì‹œ - HTML í—¤ë”© íƒœê·¸ì²˜ëŸ¼ ì œí•œëœ ë¬¸ìì—´ ì¡°í•©ë„ ê°€ëŠ¥

```ts
type Levels = 1 | 2 | 3 | 4 | 5 | 6;
type Headings = `H${Levels}`; // "H1" | "H2" | ...
```

---

### 5. ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ êµ¬í˜„

#### ì´ë²¤íŠ¸ ì½œë°± íƒ€ì…

```ts
type EventObject<T> = { val: T };
type Callback<T = any> = (ev: EventObject<T>) => void;
```
- ì½œë°±ì˜ ì¸ìëŠ” { val: T } í˜•íƒœ
- ë‹¨ìˆœíˆ ê°’ì„ ë„˜ê¸°ê¸°ë³´ë‹¤ëŠ” í™•ì¥ ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ì •ë³´ ê°ì²´ë¡œ ì „ë‹¬

- ```typescript
  const cb: Callback<number> = (ev) => {
    console.log(ev.val); // number íƒ€ì…
  };
  ```
  - Callback<number> â†’ ev: EventObject<number> â†’ { val: number }
  - ê²°êµ­ ì½œë°± í•¨ìˆ˜ì˜ ì¸ìëŠ” { val: number } ê°ì²´ë¼ëŠ” ì˜ë¯¸.
---
  - ì´ë ‡ê²Œ ê°ì‹¼ ì´ìœ  - ì•„ë˜ì™€ ê°™ì´í•˜ë©´ ì§ì ‘ ê°’ë§Œ ë°›ëŠ” êµ¬ì¡°ê°€ ë¨
  - ```typescript
    type Callback<T = any> = (value: T) => void;
    ```
    - ê·¸ëŸ°ë° ì‹¤ì œ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì—ì„œëŠ”:
    -  ì´ë²¤íŠ¸ ë©”íƒ€ ì •ë³´ê°€ ì¶”ê°€ë  ìˆ˜ ìˆìŒ â†’ { val: T, timestamp: Date }ì²˜ëŸ¼
    -  ë¯¸ë˜ í™•ì¥ì„±ì„ ê³ ë ¤í•´ì„œ êµ¬ì¡°í™”ëœ ì˜¤ë¸Œì íŠ¸ë¡œ ì „ë‹¬
    -  ê·¸ë˜ì„œ ëŒ€ë¶€ë¶„ì˜ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì€ ì½œë°± íŒŒë¼ë¯¸í„°ë¥¼ ë‹¨ìˆœ íƒ€ì…ìœ¼ë¡œ ì „ë‹¬í•˜ì§€ ì•Šê³ ,
    - ì´ë ‡ê²Œ ì´ë²¤íŠ¸ ì˜¤ë¸Œì íŠ¸ë¡œ ê°ì‹¸ì„œ ì „ë‹¬í•¨.
---

#### ì´ë²¤íŠ¸ ì €ì¥ êµ¬ì¡°

```ts
type Events = {
  [x: EventName]: Callback[] | undefined;
};
```
- EventNameì„ í‚¤ë¡œ, ì½œë°± ë°°ì—´ì„ ê°’ìœ¼ë¡œ ì €ì¥
---

#### í´ë˜ìŠ¤ ì „ì²´ êµ¬ì¡°

```ts
class EventSystem {
  events: Events;

  constructor() {
    this.events = {};
  }

  defineEventHandler(ev: EventName, cb: Callback): void {
    this.events[ev] = this.events[ev] ?? [];
    this.events[ev]?.push(cb);
  }

  trigger(ev: EventName, value: any) {
    let callbacks = this.events[ev];
    if (callbacks) {
      callbacks.forEach((cb) => cb({ val: value }));
    }
  }
}
```
- ì´ ì‹œìŠ¤í…œì˜ ê¸°ëŠ¥ì€:
  - "onClick"ì²˜ëŸ¼ "on"ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì´ë²¤íŠ¸ ì´ë¦„ë§Œ í—ˆìš©
  - ì½œë°±ì„ ë“±ë¡í•˜ë©´ ë‚˜ì¤‘ì— triggerë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŒ
- ë¬¸ì œì 
  - ì´ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì€ trigger("onClick", value)ë¥¼ ì§ì ‘ í˜¸ì¶œí•´ì•¼ í•¨
    â†’ ì¦‰, ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ triggerë¥¼ í˜¸ì¶œí•´ì•¼ í•œë‹¤ëŠ” ê²ƒ.
  - í•˜ì§€ë§Œ ì§„ì§œ DOM ì´ë²¤íŠ¸ë‚˜ ìƒíƒœ ì‹œìŠ¤í…œì²˜ëŸ¼,
  - ì†ì„±(obj.age = 41)ì´ ë°”ë€Œë©´ ìë™ìœ¼ë¡œ ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ë˜ë„ë¡ ë§Œë“¤ê³  ì‹¶ì€ ê±°ì„.
---

### 6. ì‚¬ìš© ì˜ˆì‹œ 

```ts
const system = new EventSystem();

system.defineEventHandler("click", () => {});     // âŒ ì˜¤ë¥˜
system.defineEventHandler("onClick", () => {});   // âœ… í†µê³¼
system.defineEventHandler("onchange", () => {});  // âœ… í†µê³¼
```
- "on"ìœ¼ë¡œ ì‹œì‘í•˜ì§€ ì•ŠëŠ” ë¬¸ìì—´ì€ EventNameì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì»´íŒŒì¼ ì˜¤ë¥˜

---

### ğŸ” ì •ë¦¬

| ëª©ì  | í•´ê²° ë°©ë²• |
|------|------------|
| `"on"`ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë¬¸ìì—´ë§Œ í—ˆìš© | í…œí”Œë¦¿ ë¦¬í„°ëŸ´ íƒ€ì… ì‚¬ìš© â†’ `on${string}` |
| ë” ì¢ì€ ë¬¸ìì—´ ë¦¬í„°ëŸ´ ì„œë¸Œì…‹ ìƒì„± | ìœ ë‹ˆì˜¨ íƒ€ì…ê³¼ ì¡°í•©í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥ |
| ë¬¸ìì—´ íŒ¨í„´ì˜ íƒ€ì… ìœ íš¨ì„± ê²€ì¦ | ì¼ë°˜ `string`ë³´ë‹¤ êµ¬ì²´ì ì¸ ì œì•½ ì œê³µ |

---

## 6.2 ë¬¸ìì—´ ì¡°ì‘ê³¼ í‚¤ ë¦¬ë§¤í•‘ìœ¼ë¡œ ì´ë²¤íŠ¸ ì½œë°± ë§Œë“¤ê¸°

---

### 1. ì´ ì¥ì€

- ê°ì²´ì˜ ê° í”„ë¡œí¼í‹°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì½œë°±ì„ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡,
- **`onXChanged` í˜•íƒœì˜ ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±**í•˜ëŠ” íƒ€ì…ì„ ë§Œë“¤ê³ ,
- ì´ë¥¼ ì‹¤ì œë¡œ ë™ì‘í•˜ê²Œ í•˜ëŠ” **í”„ë¡ì‹œ ê¸°ë°˜ ê°ì‹œ ì‹œìŠ¤í…œ**ì„ êµ¬í˜„í•˜ëŠ” ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤.

---

### 2. ìš°ë¦¬ê°€ ë‹¤ë£¨ëŠ” ëŒ€ìƒ
- ì›ë³¸ ê°ì²´ì˜ ê° ì†ì„±(name, age)ì— ëŒ€í•´:
  - onNameChanged, onAgeChanged í˜•íƒœì˜ ë©”ì„œë“œë¥¼ ìë™ ìƒì„±
  - ì´ ë©”ì„œë“œëŠ” ì½œë°±ì„ ë“±ë¡í•  ìˆ˜ ìˆìŒ
#### ê°ì‹œ ëŒ€ìƒ ê°ì²´

```ts
let person = {
  name: "Stefan",
  age: 40,
};

const watchedPerson = system.watch(person);
watchedPerson.onAgeChanged((ev) => {
  console.log(ev.val, "changed!!");
});

watchedPerson.age = 41; // => 41 changed!!
```

---

### 3. ë¬¸ì œ ìƒí™©

- ê°ì²´ì˜ ì†ì„±ì´ ë°”ë€” ë•Œ ì‹¤í–‰ë  **ì½œë°± ë©”ì„œë“œ**ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ìŒ
- `"onAgeChanged"`, `"onNameChanged"` ê°™ì€ í˜•ì‹ì˜ ë©”ì„œë“œë¥¼ **íƒ€ì… ìˆ˜ì¤€ì—ì„œ ìë™ ìƒì„±**
- ê°ì²´ì˜ ì†ì„±ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ëŒ€ì‘ë˜ëŠ” ì½œë°±ì„ í˜¸ì¶œí•˜ê³  ì‹¶ë‹¤.
- í•˜ì§€ë§Œ í”„ë¡œí¼í‹°ë³„ë¡œ ì¼ì¼ì´ "onAgeChanged", "onNameChanged" ë“±ì˜ íƒ€ì…ì„ ëª…ì‹œí•˜ë©´ í™•ì¥ì„±ì´ ì—†ìŒ.
- ë¬¸ìì—´ ê¸°ë°˜ ì‹œìŠ¤í…œì—ì„œ íŠ¹ì • íŒ¨í„´(on${Key}Changed)ì„ ë”°ë¥´ëŠ” íƒ€ì…ì„ ìë™ ìƒì„±í•˜ê³  ì‹¶ë‹¤.
---

### 4. í•´ê²° ì „ëµ

#### 1) ê¸°ë³¸ ì½œë°± íƒ€ì…

```ts
type Callback<T = any> = (ev: { val: T }) => void;
```

#### 2) ê°ì‹œ ê°ì²´ì˜ ì´ë²¤íŠ¸ ë©”ì„œë“œ íƒ€ì…

```ts
type WatchedObject<T> = {
  [K in string & keyof T as `on${Capitalize<K>}Changed`]: (
    ev: Callback<T[K]>
  ) => void;
};
```

- `keyof T` : ëŒ€ìƒ ê°ì²´ì˜ ëª¨ë“  í‚¤
- `as` ì ˆë¡œ í‚¤ë¥¼ `on${...}Changed` í˜•ì‹ìœ¼ë¡œ ë¦¬ë§¤í•‘
- `Capitalize<K>` : `"age"` â†’ `"Age"` ë³€í™˜
- ê° ë©”ì„œë“œëŠ” í•´ë‹¹ í”„ë¡œí¼í‹°ì˜ íƒ€ì…ì„ ê°€ì§„ ì´ë²¤íŠ¸ ì½œë°±ì„ ë°›ìŒ

---

### 5. ìƒì„±ëœ íƒ€ì… ì˜ˆì‹œ

```ts
type Person = {
  name: string;
  age: number;
};

type WatchedPerson = WatchedObject<Person>;
// =>
// {
//   onNameChanged: (ev: { val: string }) => void;
//   onAgeChanged: (ev: { val: number }) => void;
// }
```

---

### 6. ë¬¸ìì—´ ìœ í‹¸ í•¨ìˆ˜ êµ¬í˜„

```ts
function capitalize(inp: string) {
  return inp.charAt(0).toUpperCase() + inp.slice(1);
}

function handlerName(name: string): `on${string}` {
  return `on${capitalize(name)}Changed`;
}
```

---

### 7. `watch()` ë©”ì„œë“œ êµ¬í˜„

#### 1) `get` í•¸ë“¤ëŸ¬ (onXChanged ì½œë°± ë“±ë¡)

```ts
get(target, property) {
  if (
    typeof property === "string" &&
    property.startsWith("on") &&
    property.endsWith("Changed")
  ) {
    return (cb: Callback) => {
      self.defineEventHandler(property, cb);
    };
  }
  return target[property as keyof T];
}
```

#### 2) `set` í•¸ë“¤ëŸ¬ (ê°’ ë³€ê²½ ì‹œ ì½œë°± ì‹¤í–‰)

```ts
set(target, property, value) {
  if (property in target && typeof property === "string") {
    target[property as keyof T] = value;
    self.trigger(handlerName(property), value);
    return true;
  }
  return false;
}
```

---

### 8. ì „ì²´ êµ¬ì¡°

```ts
class EventSystem {
  events: Record<string, Callback[]> = {};

  defineEventHandler(ev: string, cb: Callback) {
    this.events[ev] = this.events[ev] ?? [];
    this.events[ev]?.push(cb);
  }

  trigger(ev: string, value: any) {
    this.events[ev]?.forEach((cb) => cb({ val: value }));
  }

  watch<T extends object>(obj: T): T & WatchedObject<T> {
    const self = this;
    return new Proxy(obj, {
      get(target, property) {
        if (
          typeof property === "string" &&
          property.startsWith("on") &&
          property.endsWith("Changed")
        ) {
          return (cb: Callback) => {
            self.defineEventHandler(property, cb);
          };
        }
        return target[property as keyof T];
      },
      set(target, property, value) {
        if (property in target && typeof property === "string") {
          target[property as keyof T] = value;
          self.trigger(handlerName(property), value);
          return true;
        }
        return false;
      },
    }) as T & WatchedObject<T>;
  }
}
```

---

### ğŸ” ì •ë¦¬

| ëª©ì  | ì‚¬ìš©í•œ íƒ€ì… ë„êµ¬ |
|------|------------------|
| `onAgeChanged` í˜•ì‹ì˜ ë©”ì„œë“œ ìë™ ìƒì„± | í…œí”Œë¦¿ ë¦¬í„°ëŸ´ íƒ€ì… `` `on${Capitalize<K>}Changed` `` |
| í”„ë¡œí¼í‹° íƒ€ì… ë”°ë¼ ì½œë°± íŒŒë¼ë¯¸í„° ì •ì˜ | `Callback<T[K]>` |
| ì‹¤í–‰ ì‹œì ì— ì½œë°± í˜¸ì¶œ êµ¬í˜„ | í”„ë¡ì‹œ ê°ì²´ì˜ `set` í•¸ë“¤ëŸ¬ |
| ì½œë°± ë“±ë¡ ë©”ì„œë“œ êµ¬í˜„ | í”„ë¡ì‹œ ê°ì²´ì˜ `get` í•¸ë“¤ëŸ¬ |

---

### âœ… í•µì‹¬ ìš”ì•½

- **Key Remapping + Template Literal Types + String Manipulation** ì¡°í•©ìœ¼ë¡œ,
  ê°ì²´ í”„ë¡œí¼í‹°ì— ê¸°ë°˜í•œ ìƒˆ ë©”ì„œë“œë¥¼ íƒ€ì… ìˆ˜ì¤€ì—ì„œ ìƒì„± ê°€ëŠ¥
- ì‹¤ì‹œê°„ ê°ì‹œ ì‹œìŠ¤í…œì„ ì•ˆì „í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” **íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ ëŒ€í‘œì ì¸ ê³ ê¸‰ í™œìš© ì‚¬ë¡€**


## 6.3 í¬ë§· í•¨ìˆ˜ êµ¬í˜„í•˜ê¸°

## 6.4 í¬ë§· ë§¤ê°œë³€ìˆ˜ í˜•ì‹ ì¶”ì¶œí•˜ê¸°

## 6.5 ì¬ê·€ í•œê³„ ì²˜ë¦¬í•˜ê¸°

## 6.6 í…œí”Œë¦¿ ë¦¬í„°ëŸ´ì„ êµ¬ë³„ìë¡œ ì‚¬ìš©í•˜ê¸°


